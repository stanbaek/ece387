
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>üî¨ Lab11: AprilTag &#8212; Introduction to Robotic Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Labs/Lab11_AprilTag';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="üöÄ Final Project" href="FinalProject.html" />
    <link rel="prev" title="üî¨ Lab10: CV" href="Lab10_CV.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/ece387.png" class="logo__image only-light" alt="Introduction to Robotic Systems - Home"/>
    <img src="../_static/ece387.png" class="logo__image only-dark pst-js-only" alt="Introduction to Robotic Systems - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE 387 Introduction to Robotic Systems
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">üìå Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">üìÜ Course Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonBasic.html">üêç Python Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonIntermediate.html">üêç Python Intermediate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NumPy.html">‚ûï NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">üôã FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/NoPointer.html">No Pointers in Python?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Labs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lab1_Linux.html">üî¨ Lab1: Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab2_ROS.html">üî¨ Lab2: ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab3_Python.html">üî¨ Lab3: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab4_Gamepad.html">üî¨ Lab4: Gamepad</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab5_TurtleBot.html">üî¨ Lab5: Driving the Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab6_IMU.html">üî¨ Lab6: IMU-Based Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab7_TF.html">üî¨ Lab7: Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab8_LIDAR.html">üî¨ Lab 8: LiDAR</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab9_SLAM.html">üî¨ Lab9: SLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab10_CV.html">üî¨ Lab10: CV</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">üî¨ Lab11: AprilTag</a></li>
<li class="toctree-l1"><a class="reference internal" href="FinalProject.html">üöÄ Final Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Appendix/RobotSetup.html">üîß Robot Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/MasterSetup.html">üîß Master Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/GitSetup.html">üîß Git Repo Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/GamepadSetup.html">üîß Gamepad Setup</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/stanbaek/ece387" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/stanbaek/ece387/issues/new?title=Issue%20on%20page%20%2FLabs/Lab11_AprilTag.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Labs/Lab11_AprilTag.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>üî¨ Lab11: AprilTag</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">üìú Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-procedures">üõ†Ô∏è Lab Procedures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-calibrate-the-usb-camera">‚úÖ Part 1: Calibrate the USB Camera</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-apriltag-detection-with-ros2">‚úÖ Part 2: AprilTag Detection with ROS2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-launch">‚úÖ Part 3: Launch</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">üöö Deliverables</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab11-apriltag">
<h1>üî¨ Lab11: AprilTag<a class="headerlink" href="#lab11-apriltag" title="Link to this heading">#</a></h1>
<section id="objectives">
<h2>üìå Objectives<a class="headerlink" href="#objectives" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Students should be able to explain the purpose of fiducial markers in robotics.</p></li>
<li><p>Students should be able to calibrate a USB camera using ROS2 tools and a checkerboard pattern.</p></li>
<li><p>Students should be able to explain and interpret ROS2 camera calibration messages.</p></li>
<li><p>Students should be able to set up and run a ROS2 node for AprilTag detection.</p></li>
<li><p>Students should be able to interpret position and orientation data from detected AprilTags.</p></li>
<li><p>Students should be able to demonstrate the ability to use AprilTag data for estimating distance to objects.</p></li>
</ul>
</section>
<section id="overview">
<h2>üìú Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>This lab introduces the use of <strong>fiducial markers</strong>‚Äîspecifically <strong>AprilTags</strong>‚Äîfor robot perception and navigation. These markers are used in robotics for tasks like localization, mapping, and interaction with known objects. AprilTags are square, black-and-white markers that encode an ID in a unique pattern, allowing them to be recognized by a vision system.</p>
<p>We‚Äôll use <strong>ROS2</strong> tools and a camera to detect AprilTags in the environment. The camera will provide images to a detection node, which will process these images and estimate the 3D pose (position and orientation) of each tag relative to the camera. With this information, we can calculate the robot‚Äôs distance from the tag and understand its spatial relationship to the object.</p>
<p>Before detecting tags, we must first calibrate the USB camera to correct for lens distortion and establish a reliable relationship between image pixels and real-world measurements. Calibration ensures accurate position and distance calculations.</p>
<p>This lab will also help solidify your understanding of ROS2 topics, nodes, and message types‚Äîall critical for real-world robotic applications.</p>
</section>
<hr class="docutils" />
<section id="lab-procedures">
<h2>üõ†Ô∏è Lab Procedures<a class="headerlink" href="#lab-procedures" title="Link to this heading">#</a></h2>
<section id="part-1-calibrate-the-usb-camera">
<h3>‚úÖ Part 1: Calibrate the USB Camera<a class="headerlink" href="#part-1-calibrate-the-usb-camera" title="Link to this heading">#</a></h3>
<p>For a camera to effectively perform computer vision tasks, it must first be calibrated. Without calibration, there‚Äôs no reliable reference for determining the size of objects within the camera‚Äôs frame. The <a class="reference external" href="http://wiki.ros.org/camera_calibration">ROS Calibration Tool</a> generates a calibration file that other ROS packages can use to calculate object size and distance. The <strong>camera_calibration</strong> package leverages OpenCV‚Äôs calibration techniques to simplify the process of calibrating monocular or stereo cameras, typically using a checkerboard pattern as the target. For detailed instructions, refer to the <a class="reference external" href="http://wiki.ros.org/camera_calibration/Tutorials/MonocularCalibration">Camera Calibration Tutorial</a>.</p>
<ol class="arabic">
<li><p>Disconnect the camera from the robot and plug it into the <strong>Master computer</strong>. Then run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>usb_cam<span class="w"> </span>usb_cam_node_exe<span class="w"> </span>--ros-args<span class="w"> </span>-p<span class="w"> </span>video_device:<span class="o">=</span>/dev/video0
</pre></div>
</div>
</li>
<li><p>Check if topics are being published:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span>list
</pre></div>
</div>
<p>Make sure you see <code class="docutils literal notranslate"><span class="pre">/image_raw</span></code> and <code class="docutils literal notranslate"><span class="pre">/camera_info</span></code>. Then check the message type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">type</span><span class="w"> </span>/camera_info
ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>&lt;message&gt;
</pre></div>
</div>
</li>
<li><p>Echo the camera info:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/camera_info
</pre></div>
</div>
<p>Look for values under <code class="docutils literal notranslate"><span class="pre">K</span></code>, <code class="docutils literal notranslate"><span class="pre">R</span></code>, and <code class="docutils literal notranslate"><span class="pre">P</span></code>. Initially, they‚Äôll be all zeros‚Äîthis means the camera is not yet calibrated.</p>
<blockquote>
<div><p>üí° You should be comfortable using these ROS2 commands. Expect to answer related questions during graded reviews (GRs).</p>
</div></blockquote>
</li>
<li><p>Run the calibration tool. Use the checkerboard (9x6 internal corners, 2.5 cm spacing). Run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>camera_calibration<span class="w"> </span>cameracalibrator<span class="w"> </span>--size<span class="w"> </span>9x6<span class="w"> </span>--square<span class="w"> </span><span class="m">0</span>.025<span class="w"> </span>--camera_name<span class="w"> </span>default_cam<span class="w"> </span>--no-service-check<span class="w"> </span>--ros-args<span class="w"> </span>-r<span class="w"> </span>image:<span class="o">=</span>/image_raw
</pre></div>
</div>
<p>This launches a calibration window.</p>
<a class="reference internal image-reference" href="../_images/Lab11_Calibration.png"><img alt="../_images/Lab11_Calibration.png" class="align-center" src="../_images/Lab11_Calibration.png" style="width: 500px;" /></a>
</li>
<li><p>To collect calibration data, move the checkerboard in the camera view in various ways:</p>
<ul class="simple">
<li><p>Left/right/top/bottom</p></li>
<li><p>Closer/farther</p></li>
<li><p>Tilted at angles</p></li>
<li><p>Fill the entire frame</p></li>
</ul>
<p>Four progress bars will fill up. When the ‚ÄúCALIBRATE‚Äù button activates, click it.</p>
<a class="reference internal image-reference" href="../_images/Lab11_Calibrate.png"><img alt="../_images/Lab11_Calibrate.png" class="align-center" src="../_images/Lab11_Calibrate.png" style="width: 500px;" /></a>
<blockquote>
<div><p>üïì Calibration may take a few minutes. The windows might be greyed out but just wait, it is working.</p>
</div></blockquote>
<p>When complete, it will display something similar to the following output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>****<span class="w"> </span>Calibrating<span class="w"> </span>****
mono<span class="w"> </span>pinhole<span class="w"> </span>calibration...
<span class="nv">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>-0.027598200869062808,<span class="w"> </span>-0.0273210932029884,<span class="w"> </span><span class="m">0</span>.002259050714452529,<span class="w"> </span><span class="m">0</span>.004238057516107571,<span class="w"> </span><span class="m">0</span>.0<span class="o">]</span>
<span class="nv">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="m">517</span>.6781776101559,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">330</span>.5433124974498,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">522</span>.269778659698,<span class="w"> </span><span class="m">247</span>.60730067305022,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">1</span>.0<span class="o">]</span>
<span class="nv">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="m">1</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">1</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">1</span>.0<span class="o">]</span>
<span class="nv">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="m">508</span>.604248046875,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">333</span>.1752989083179,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">517</span>.5308227539062,<span class="w"> </span><span class="m">248</span>.01611962861898,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">1</span>.0,<span class="w"> </span><span class="m">0</span>.0<span class="o">]</span>
None
<span class="c1"># oST version 5.0 parameters</span>


<span class="o">[</span>image<span class="o">]</span>

width
<span class="m">640</span>

height
<span class="m">480</span>

<span class="o">[</span>default_cam<span class="o">]</span>

camera<span class="w"> </span>matrix
<span class="m">517</span>.678178<span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="m">330</span>.543312
<span class="m">0</span>.000000<span class="w"> </span><span class="m">522</span>.269779<span class="w"> </span><span class="m">247</span>.607301
<span class="m">0</span>.000000<span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="m">1</span>.000000

distortion
-0.027598<span class="w"> </span>-0.027321<span class="w"> </span><span class="m">0</span>.002259<span class="w"> </span><span class="m">0</span>.004238<span class="w"> </span><span class="m">0</span>.000000

rectification
<span class="m">1</span>.000000<span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="m">0</span>.000000
<span class="m">0</span>.000000<span class="w"> </span><span class="m">1</span>.000000<span class="w"> </span><span class="m">0</span>.000000
<span class="m">0</span>.000000<span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="m">1</span>.000000

projection
<span class="m">508</span>.604248<span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="m">333</span>.175299<span class="w"> </span><span class="m">0</span>.000000
<span class="m">0</span>.000000<span class="w"> </span><span class="m">517</span>.530823<span class="w"> </span><span class="m">248</span>.016120<span class="w"> </span><span class="m">0</span>.000000
<span class="m">0</span>.000000<span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="m">1</span>.000000<span class="w"> </span><span class="m">0</span>.000000
</pre></div>
</div>
</li>
<li><p>Save and extract calibration data. Click <strong>Save</strong>, then <strong>Commit</strong>. Browse to the location of the calibration data and extract</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp
tar<span class="w"> </span>xf<span class="w"> </span>calibrationdata.tar.gz
</pre></div>
</div>
<p>Move the <code class="docutils literal notranslate"><span class="pre">ost.yaml</span></code> file to the correct ROS folder with a new name, <code class="docutils literal notranslate"><span class="pre">default_cam.yaml</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/.ros
mkdir<span class="w"> </span>camera_info
mv<span class="w"> </span>/tmp/ost.yaml<span class="w"> </span>./camera_info/default_cam.yaml
</pre></div>
</div>
</li>
<li><p>Relaunch the camera node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>usb_cam<span class="w"> </span>usb_cam_node_exe<span class="w"> </span>--ros-args<span class="w"> </span>-p<span class="w"> </span>video_device:<span class="o">=</span>/dev/video0
</pre></div>
</div>
</li>
<li><p>Take another look at the <code class="docutils literal notranslate"><span class="pre">camera_info</span></code> topic. Do you notice any differences compared to the message published by the <code class="docutils literal notranslate"><span class="pre">usb_cam</span></code> node when calibration data is not included? Keep in mind that the <code class="docutils literal notranslate"><span class="pre">usb_cam</span></code> node does not use the <code class="docutils literal notranslate"><span class="pre">CameraInfo</span></code> message to produce rectified images from the raw data (<code class="docutils literal notranslate"><span class="pre">\image_raw</span></code>). Instead, it publishes the <code class="docutils literal notranslate"><span class="pre">CameraInfo</span></code> message so that you can use it to create rectified images if needed.</p></li>
<li><p>Take a screenshot of the calibrated <code class="docutils literal notranslate"><span class="pre">camera_info</span></code> output. This is one of your deliverables.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="part-2-apriltag-detection-with-ros2">
<h3>‚úÖ Part 2: AprilTag Detection with ROS2<a class="headerlink" href="#part-2-apriltag-detection-with-ros2" title="Link to this heading">#</a></h3>
<p>In this section, you will explore how to detect AprilTags in ROS 2. There are several methods to achieve this, one of which involves using multiple existing ROS nodes and connecting them via ROS topics. While this approach may seem straightforward, managing the interactions between different nodes can become complex and inefficient. To simplify this process, we will develop our own custom node to handle all the required functionality.</p>
<ol class="arabic simple">
<li><p>Create a package named <code class="docutils literal notranslate"><span class="pre">lab11_apriltag</span></code> with the dependencies:</p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rclpy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv_bridge</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sensor_msgs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std_msgs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">opencv2</span></code></p></li>
</ul>
<ol class="arabic">
<li><p>Download the provided <a class="reference download internal" download="" href="../_downloads/8f80d7f13c4a3d59f0288737b0c97faf/apriltag.py"><span class="xref download myst"><code class="docutils literal notranslate"><span class="pre">apriltag.py</span></code></span></a> and place it in your package‚Äôs scripts directory.</p></li>
<li><p>Update your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> to include the script as an entry point. This is necessary to ensure that the script runs as a node.</p></li>
<li><p>Inside your package (not the scripts folder), create a new directory called <code class="docutils literal notranslate"><span class="pre">config</span></code>. Next, copy the <code class="docutils literal notranslate"><span class="pre">default_cam.yaml</span></code> file into this directory. The code in <code class="docutils literal notranslate"><span class="pre">apriltag.py</span></code> is already set up to load this default calibration file if no calibration file path is provided by the user when the node is executed. Your directory structure should look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lab11_apriltag/
‚îú‚îÄ‚îÄ<span class="w"> </span>config/
‚îÇ<span class="w">   </span>‚îî‚îÄ‚îÄ<span class="w"> </span>default_cam.yaml
‚îú‚îÄ‚îÄ<span class="w"> </span>lab11_apriltag/
‚îú‚îÄ‚îÄ<span class="w"> </span>resources/
‚îî‚îÄ‚îÄ<span class="w"> </span>...
</pre></div>
</div>
</li>
<li><p>Add this path to your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> under <code class="docutils literal notranslate"><span class="pre">data_files</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;/config&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;config/default_cam.yaml&#39;</span><span class="p">]),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>And in <code class="docutils literal notranslate"><span class="pre">package.xml</span></code>, include:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;buildtool_depend&gt;</span>ament_cmake<span class="nt">&lt;/buildtool_depend&gt;</span>
<span class="nt">&lt;exec_depend&gt;</span>ament_index_python<span class="nt">&lt;/exec_depend&gt;</span>
</pre></div>
</div>
</li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">apriltag.py</span></code> script and examine the constructor to understand how it handles loading files via command line arguments. If no argument is provided, it defaults to a pre-configured file. Pay close attention to the <code class="docutils literal notranslate"><span class="pre">load_camera_info</span></code> method‚Äîit demonstrates how to extract data from a <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file effectively. While the same functionality could be achieved by subscribing to the <code class="docutils literal notranslate"><span class="pre">camera_info</span></code> topic published by the <code class="docutils literal notranslate"><span class="pre">usb_cam</span></code> node, using a calibration file is more efficient since the <code class="docutils literal notranslate"><span class="pre">camera_info</span></code> topic repeatedly publishes identical data over time.</p></li>
<li><p>Launch the <code class="docutils literal notranslate"><span class="pre">usb_cam</span></code> node with a frame rate set to <strong>15 Hz</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>usb_cam<span class="w"> </span>usb_cam_node_exe<span class="w"> </span>--ros-args<span class="w"> </span>-p<span class="w"> </span>vidoe_device:<span class="o">=</span>/dev/video0<span class="w"> </span>-p<span class="w"> </span>framerate:<span class="o">=</span><span class="m">15</span>.0
</pre></div>
</div>
</li>
<li><p>Start the <code class="docutils literal notranslate"><span class="pre">apriltag_ros</span></code> node to detect AprilTags.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>lab11_apriltag<span class="w"> </span>apriltag_node<span class="w"> </span>--ros-args<span class="w"> </span>-p<span class="w"> </span>cammera_info_file:<span class="o">=</span>~/.ros/camera_info/default_cam.yam1
</pre></div>
</div>
</li>
<li><p>Open another terminal and echo the topic <code class="docutils literal notranslate"><span class="pre">/apriltag_pose</span></code> on the master. Observe the output. Does the <code class="docutils literal notranslate"><span class="pre">apriltag_ros</span></code> node detect more than one tag simultaneously? Consider which value might be used to calculate the distance to a tag, and note the type of message being published. Identify the package this message originates from.</p></li>
<li><p>Demonstrate to the instructor that the <strong>apriltag_ros</strong> node is successfully detecting tags and publishing their position data.</p></li>
</ol>
<p>With a properly calibrated camera, you are now equipped to identify AprilTags along with their size, orientation, and distance.</p>
</section>
<section id="part-3-launch">
<h3>‚úÖ Part 3: Launch<a class="headerlink" href="#part-3-launch" title="Link to this heading">#</a></h3>
<p>This section guides you through creating a launch file to run three key nodes: <code class="docutils literal notranslate"><span class="pre">usb_cam</span></code>, <code class="docutils literal notranslate"><span class="pre">stop_detector</span></code>, and <code class="docutils literal notranslate"><span class="pre">apriltag_node</span></code>, with the required parameters.</p>
<ol class="arabic">
<li><p>Revisit the <code class="docutils literal notranslate"><span class="pre">gamepad.launch.py</span></code> file from Lab 8 (<a class="reference internal" href="Lab8_LIDAR.html#lidar-launch"><span class="std std-ref">Using ROS2 Launch Files</span></a>). This section provides only an overview, so ensure you thoroughly refresh your understanding of the launch file creation process before proceeding.</p></li>
<li><p>Locate the <code class="docutils literal notranslate"><span class="pre">stop_detector.svm</span></code> file from Lab 10 and copy it to the <code class="docutils literal notranslate"><span class="pre">config</span></code> directory within the <code class="docutils literal notranslate"><span class="pre">lab11_apriltag</span></code> package. Then, update the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script by adding <code class="docutils literal notranslate"><span class="pre">stop_detector.svm</span></code> to the <code class="docutils literal notranslate"><span class="pre">data_files</span></code> section. This step ensures the file is appropriately packaged and accessible.</p></li>
<li><p>Download the provided <a class="reference download internal" download="" href="../_downloads/a14f74db605cddf98fbb38d7b3fa72cc/vision.launch.py"><span class="xref download myst"><code class="docutils literal notranslate"><span class="pre">vision.launch.py</span></code></span></a> and place it in the launch directory of the <code class="docutils literal notranslate"><span class="pre">lab11_apriltag</span></code> package.</p>
<ul>
<li><p>Edit this file as you did in Lab 8, ensuring you include all three nodes: <code class="docutils literal notranslate"><span class="pre">usb_cam</span></code>, <code class="docutils literal notranslate"><span class="pre">stop_detector</span></code>, and <code class="docutils literal notranslate"><span class="pre">apriltag_node</span></code>.</p></li>
<li><p>Ensure the necessary import statements and configuration setup:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">launch</span><span class="w"> </span><span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">launch_ros.actions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ament_index_python.packages</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_package_share_directory</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</pre></div>
</div>
</li>
<li><p>Make sure the paths to important configuration files are correctly configured.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pkg_share</span> <span class="o">=</span> <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;lab11_apriltag&#39;</span><span class="p">)</span>
<span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pkg_share</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">)</span>

<span class="n">stop_detector_model</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_dir</span><span class="p">,</span> <span class="s1">&#39;stop_detector.svm&#39;</span><span class="p">)</span>
<span class="n">camera_info_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_dir</span><span class="p">,</span> <span class="s1">&#39;default_cam.yaml&#39;</span><span class="p">)</span>
<span class="n">camera_info_url</span> <span class="o">=</span> <span class="s1">&#39;file://&#39;</span> <span class="o">+</span> <span class="n">camera_info_path</span>
</pre></div>
</div>
</li>
<li><p>Ensure the nodes are properly configured with the required parameters. Use paths to the configuration files to make your launch file robust and dynamic.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Do not copy code snippets verbatim without understanding their functionality.</strong> You will be required to answer related questions during GRs or assessments, so ensure your comprehension of each step and its purpose.</p>
</div>
</li>
<li><p>Add the launch file (<code class="docutils literal notranslate"><span class="pre">vision.launch.py</span></code>) to the <code class="docutils literal notranslate"><span class="pre">data_files</span></code> section in the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script. This inclusion ensures the launch file is packaged correctly.</p></li>
<li><p>Build and Test</p>
<ul class="simple">
<li><p>Build your package to compile any changes made.</p></li>
<li><p>Execute the <code class="docutils literal notranslate"><span class="pre">vision.launch.py</span></code> file. Verify that the nodes (<code class="docutils literal notranslate"><span class="pre">usb_cam</span></code>, <code class="docutils literal notranslate"><span class="pre">stop_detector</span></code>, and <code class="docutils literal notranslate"><span class="pre">apriltag_node</span></code>) launch successfully.</p></li>
<li><p>Confirm detection functionality by observing the published topics and verifying that both stop signs and AprilTags are detected accurately.</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="deliverables">
<h2>üöö Deliverables<a class="headerlink" href="#deliverables" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>[15 Points] Complete the <code class="docutils literal notranslate"><span class="pre">apriltag.py</span></code> Script</strong></p>
<ul class="simple">
<li><p>Implement all required features to ensure the script is fully functional.</p></li>
<li><p>Push your code to GitHub and confirm that it has been successfully uploaded.
<strong>NOTE:</strong> <em>If the instructor can‚Äôt find your code in your repository, you will receive a grade of 0 for the coding part.</em></p></li>
</ul>
</li>
<li><p><strong>[10 Points] Submit Screenshots</strong></p>
<ul class="simple">
<li><p>Submit a screenshot of the <code class="docutils literal notranslate"><span class="pre">camera_info</span></code> topic.</p></li>
</ul>
</li>
<li><p><strong>[25 Points] Demonstration</strong></p>
<ul class="simple">
<li><p>Demonstrate simultaneous detection of multiple AprilTags (minimum of 2) and stop signs by running both <code class="docutils literal notranslate"><span class="pre">apriltag_ros</span></code> and <code class="docutils literal notranslate"><span class="pre">stop_detector</span></code> nodes. Verify proper operation by showing that both nodes are publishing valid messages to their respective topics (<code class="docutils literal notranslate"><span class="pre">/apriltag_pose</span></code> and <code class="docutils literal notranslate"><span class="pre">/stop_dist</span></code>).</p></li>
</ul>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lab10_CV.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">üî¨ Lab10: CV</p>
      </div>
    </a>
    <a class="right-next"
       href="FinalProject.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">üöÄ Final Project</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">üìú Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-procedures">üõ†Ô∏è Lab Procedures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-calibrate-the-usb-camera">‚úÖ Part 1: Calibrate the USB Camera</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-apriltag-detection-with-ros2">‚úÖ Part 2: AprilTag Detection with ROS2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3-launch">‚úÖ Part 3: Launch</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">üöö Deliverables</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stan Baek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>