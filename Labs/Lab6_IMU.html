
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>üî¨ Lab6: IMU-Based Navigation &#8212; Introduction to Robotic Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Labs/Lab6_IMU';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="üî¨ Lab7: Transformation" href="Lab7_TF.html" />
    <link rel="prev" title="üî¨ Lab5: Driving the Robot" href="Lab5_TurtleBot.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/ece387.png" class="logo__image only-light" alt="Introduction to Robotic Systems - Home"/>
    <script>document.write(`<img src="../_static/ece387.png" class="logo__image only-dark" alt="Introduction to Robotic Systems - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE 387 Introduction to Robotic Systems
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">üìå ECE387 Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">üìÜ Course Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AI_policy.html">ü§ñ AI Usage Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">üôã FAQ</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Labs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lab1_Linux.html">üî¨ Lab1: Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab2_ROS.html">üî¨ Lab2: ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab3_Python.html">üî¨ Lab3: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab4_Gamepad.html">üî¨ Lab4: Gamepad</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab5_TurtleBot.html">üî¨ Lab5: Driving the Robot</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">üî¨ Lab6: IMU-Based Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab7_TF.html">üî¨ Lab7: Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab8_LIDAR.html">üî¨ Lab8: LiDAR</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab9_SLAM.html">üî¨ Lab9: SLAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab10_CV.html">üî¨ Lab10: CV</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab11_AprilTag.html">üî¨ Lab11: AprilTag</a></li>
<li class="toctree-l1"><a class="reference internal" href="FinalProject.html">üöÄ Final Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Supplementary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/workshops/PythonBasic.html">Python PythonBasic</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/workshops/PythonIntermediate.html">Python Containers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/workshops/NumPy.html">NumPy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/NoPointer.html">No Pointers in Python?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Appendix/RobotSetup.html">üîß Robot Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/MasterSetup.html">üîß Master Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/GitSetup.html">üîß Git Repo Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/GamepadSetup.html">üîß Gamepad Setup</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/stanbaek/ece387" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/stanbaek/ece387/issues/new?title=Issue%20on%20page%20%2FLabs/Lab6_IMU.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Labs/Lab6_IMU.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>üî¨ Lab6: IMU-Based Navigation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">üìú Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-lab-testing-the-imu">üå± Pre-Lab: Testing the IMU</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-launch-the-turtlebot3-simulation">Step 1: Launch the TurtleBot3 Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-verify-communication-with-the-master">Step 2: Verify Communication with the Master</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-examine-the-imu-and-odom-topics">Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-visualizing-data-in-rqt">Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-procedure">üíª Lab Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bashrc-for-easier-builds">üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> for Easier Builds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-imu-on-the-physical-robot">üõ† Testing IMU on the Physical Robot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modify-gamepad-py-to-include-control-relinquishment">üõ† Modify <code class="docutils literal notranslate"><span class="pre">gamepad.py</span></code> to Include Control Relinquishment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-ros2-package"><strong>Create a New ROS2 Package</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-move2goal-py-script"><strong>Implement the <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code> Script</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-test-the-package"><strong>Build and Test the Package</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">üöö Deliverables</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab6-imu-based-navigation">
<h1>üî¨ Lab6: IMU-Based Navigation<a class="headerlink" href="#lab6-imu-based-navigation" title="Link to this heading">#</a></h1>
<section id="objectives">
<h2>üìå Objectives<a class="headerlink" href="#objectives" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Students should be able to describe how IMU data is used in ROS2 and interpret IMU messages.</p></li>
<li><p>Students should be able to set up and analyze IMU (<code class="docutils literal notranslate"><span class="pre">/imu</span></code>) and odometry (<code class="docutils literal notranslate"><span class="pre">/odom</span></code>) topics in ROS2.</p></li>
<li><p>Students should be able to modify a ROS2 gamepad node to relinquish and regain robot control using button presses.</p></li>
<li><p>Students should be able to implement a ROS2 Python node that navigates a robot to a goal using odometry and IMU data.</p></li>
<li><p>Students should be able to evaluate and analyze errors in robot navigation and suggest potential improvements.</p></li>
</ul>
</section>
<section id="overview">
<h2>üìú Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>In real-world robotics, an Inertial Measurement Unit (IMU) is essential for tracking motion by measuring orientation, angular velocity, and linear acceleration. The <a class="reference external" href="https://invensense.tdk.com/products/motion-tracking/6-axis/icm-20648/">ICM-20648 6-Axis MEMS MotionTracking Device</a> from TDK integrates a 3-axis gyroscope, a 3-axis accelerometer, and a Digital Motion Processor (DMP). This IMU is embedded in the OpenCR1.0 board, an open-source robot controller featuring an ARM Cortex-M7 processor. The OpenCR board applies an Extended Kalman Filter (EKF) to fuse sensor data, generating IMU estimates at 170 Hz.</p>
<a class="reference internal image-reference" href="../_images/IMU.jpg"><img alt="../_images/IMU.jpg" class="align-center" src="../_images/IMU.jpg" style="width: 380px;" /></a>
<br>
The IMU significantly enhances navigation accuracy when combined with odometry. It helps estimate the robot's position over time and improves localization.
<br>
<a class="reference internal image-reference" href="../_images/TurtleBot3_Coordinates.png"><img alt="../_images/TurtleBot3_Coordinates.png" class="align-center" src="../_images/TurtleBot3_Coordinates.png" style="width: 280px;" /></a>
<br>
<p>As we discussed earlier, multiple sensors work together to estimate the TurtleBot3‚Äôs attitude and heading. These sensors are highly sensitive to magnetic fields, which can vary depending on the location and the device. Even everyday electronic components, including those on the OpenCR board, generate small magnetic fields. Although the IMU is placed at the center of the robot for optimal performance, it is still exposed to various magnetic interferences.</p>
<p>Fortunately, the TurtleBot3 developers anticipated this issue. Each time you run the serial node to connect to the robot, the IMU automatically calibrates itself, ensuring more accurate readings.</p>
</section>
<section id="pre-lab-testing-the-imu">
<h2>üå± Pre-Lab: Testing the IMU<a class="headerlink" href="#pre-lab-testing-the-imu" title="Link to this heading">#</a></h2>
<section id="step-1-launch-the-turtlebot3-simulation">
<h3>Step 1: Launch the TurtleBot3 Simulation<a class="headerlink" href="#step-1-launch-the-turtlebot3-simulation" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Open a terminal and start the TurtleBot3 simulation in Gazebo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>launch<span class="w"> </span>turtlebot3_gazebo<span class="w"> </span>turtlebot_world.launch
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-2-verify-communication-with-the-master">
<h3>Step 2: Verify Communication with the Master<a class="headerlink" href="#step-2-verify-communication-with-the-master" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Ensure the TurtleBot3 is properly communicating with the Master by listing active topics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span>list
</pre></div>
</div>
</li>
<li><p>You should see the following topics, including <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/battery_state
/cmd_vel
/imu
/joint_states
/magnetic_field
/odom<span class="w">   </span>
/tf_static
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-3-examine-the-imu-and-odom-topics">
<h3>Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics<a class="headerlink" href="#step-3-examine-the-imu-and-odom-topics" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">gamepad</span></code> and <code class="docutils literal notranslate"><span class="pre">joy</span></code> nodes.</p></li>
<li><p>Observe the IMU and odometry data in real-time as you move the robot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu
$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom
</pre></div>
</div>
<p>Pay close attention to the nested fields. Be careful not to confuse the different <code class="docutils literal notranslate"><span class="pre">pose</span></code> hierarchies within the Imu and Odom messages.</p>
</li>
<li><p>Inspect the underlying message definitions so you know how to access these fields in your code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w"> </span>&lt;message_type&gt;
</pre></div>
</div>
<p>You can find the appropriate &lt;message_type&gt; by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span>info<span class="w"> </span>&lt;topic_name&gt;
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-4-visualizing-data-in-rqt">
<h3>Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code><a class="headerlink" href="#step-4-visualizing-data-in-rqt" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">rqt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>rqt
</pre></div>
</div>
</li>
<li><p>Monitor <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code> while moving the robot.</p></li>
<li><p>Compare the pose data from Gazebo and <code class="docutils literal notranslate"><span class="pre">rqt</span></code>, noting how simulation noise affects readings.</p></li>
<li><p>Monitor the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics using <code class="docutils literal notranslate"><span class="pre">rqt</span></code> as you move the robot in Gazebo.</p></li>
<li><p>In Gazebo, go to <code class="docutils literal notranslate"><span class="pre">Models</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">burger</span></code>, then in the <code class="docutils literal notranslate"><span class="pre">property</span></code> section, select <code class="docutils literal notranslate"><span class="pre">pose</span></code> to view the robot‚Äôs position and orientation in roll-pitch-yaw format.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">rqt</span></code>, enable the <code class="docutils literal notranslate"><span class="pre">Topic</span> <span class="pre">Monitor</span></code> and activate the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics to track orientation and position in real time.</p></li>
<li><p>Note that orientation in <code class="docutils literal notranslate"><span class="pre">rqt</span></code> is shown using quaternions.</p></li>
<li><p>The pose values in Gazebo and rqt are not the same. Gazebo simulation publishes position and orientation with noise. By default, Gazebo adds Gaussian noise to the data generated by its sensors to simulate real-world conditions.</p></li>
</ol>
<!-- ### Setting up Team Repository.

1. Go to [Create a Team Repository within GitHub Classroom](TeamRepo) to setup a new GitHub repository for your team. 
2. Move the `Lab4_gamepad` directory from the `ece387_lastname` directory to `ece387_ws`. You no longer need the old code. Push all the code in the `ece387_lastname` directory to your GitHub repository as a backup and delete the `ece387_lastname` directory.  
3. Navigate to your ROS2 workspace, `~/master_ws` and remove the old files by running
   ```bash
   $ rm -rf install/ build/ log/
   ```
4. Ensure you still have the `turtlebot3_simulations` and `ece387_ws` directories within the `src` directory.
5. Rebuild the local packages
   ```bash
   $ colcon build --symlink-1nstall
   ```
 -->
</section>
</section>
<section id="lab-procedure">
<h2>üíª Lab Procedure<a class="headerlink" href="#lab-procedure" title="Link to this heading">#</a></h2>
<p>In this lab, you will create a ROS2 Python package that enables the TurtleBot3 to navigate to a desired <strong>location and orientation</strong> using data from the <strong>IMU (<code class="docutils literal notranslate"><span class="pre">/imu</span></code>)</strong> and <strong>ODOM (<code class="docutils literal notranslate"><span class="pre">/odom</span></code>)</strong> topics.</p>
<section id="update-bashrc-for-easier-builds">
<h3>üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> for Easier Builds<a class="headerlink" href="#update-bashrc-for-easier-builds" title="Link to this heading">#</a></h3>
<p>To avoid common mistakes when running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code>, follow these steps to streamline your workflow. This will ensure that <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> is always run in the correct directory and that the necessary setup file is sourced automatically.</p>
<ol class="arabic">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">gedit</span></code> to open the <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gedit<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</li>
<li><p>Near the bottom the <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> file, look for the following functions. If they are not already present, add them.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to build with optional arguments</span>
<span class="k">function</span><span class="w"> </span>ccbuild<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>~/master_ws<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>colcon<span class="w"> </span>build<span class="w"> </span>--symlink-install<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span>~/master_ws/install/setup.bash
<span class="o">}</span>

<span class="c1"># Export the function to make it available in the shell</span>
<span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>ccbuild
</pre></div>
</div>
</li>
<li><p>Save the file, close the editor, and restart your terminal for the changes to take effect.</p></li>
<li><p>Instead of manually navigating to <code class="docutils literal notranslate"><span class="pre">~/master_ws</span></code>, running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span> <span class="pre">--symlink-install</span></code>, and sourcing <code class="docutils literal notranslate"><span class="pre">install/setup.bash</span></code>, you can now simply run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ccbuild
</pre></div>
</div>
<p>This ensures the build process is executed correctly every time and and sources the necessary setup file.</p>
</li>
<li><p>You can also pass arguments to <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> through the <code class="docutils literal notranslate"><span class="pre">ccbuild</span></code> function. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ccbuild<span class="w"> </span>--packages-select<span class="w"> </span>lab6_nav
</pre></div>
</div>
<p>This builds only the <code class="docutils literal notranslate"><span class="pre">lab6_nav</span></code> package, saving time by skipping previously built packages.</p>
</li>
<li><p>By following these steps, you‚Äôll streamline your workflow and minimize build-related errors.</p></li>
</ol>
</section>
<section id="testing-imu-on-the-physical-robot">
<h3>üõ† Testing IMU on the Physical Robot<a class="headerlink" href="#testing-imu-on-the-physical-robot" title="Link to this heading">#</a></h3>
<p>To test the IMU on the physical robot, follow these steps:</p>
<ol class="arabic">
<li><p>Use SSH to launch the <code class="docutils literal notranslate"><span class="pre">robot.launch.py</span></code> file on the robot.</p></li>
<li><p>Start the <code class="docutils literal notranslate"><span class="pre">gamepad</span></code> and <code class="docutils literal notranslate"><span class="pre">joy</span></code> nodes on your master computer.</p></li>
<li><p>As you move the robot in Gazebo, monitor the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom
</pre></div>
</div>
</li>
<li><p>The raw output of these topics can be overwhelming. Use the following commands to filter and display only the relevant sections:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="s1">&#39;orientation&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="s1">&#39;position&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">-A</span></code> option in <code class="docutils literal notranslate"><span class="pre">grep</span></code> stands for ‚Äúafter context.‚Äù It displays the specified number of lines following the matching line.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">/imu</span></code>, this command shows the <code class="docutils literal notranslate"><span class="pre">orientation</span></code> section and the next 4 lines.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">/odom</span></code>, it shows the <code class="docutils literal notranslate"><span class="pre">position</span></code> section and the next 3 lines.</p></li>
</ul>
</li>
<li><p><strong>Convert quaternions to Euler angles:</strong> Both topics use quaternions to represent orientation, which are not human-readable. Later, we will convert these quaternions into Euler angles for easier interpretation.</p></li>
</ol>
</section>
<section id="modify-gamepad-py-to-include-control-relinquishment">
<h3>üõ† Modify <code class="docutils literal notranslate"><span class="pre">gamepad.py</span></code> to Include Control Relinquishment<a class="headerlink" href="#modify-gamepad-py-to-include-control-relinquishment" title="Link to this heading">#</a></h3>
<p>In this section, you‚Äôll modify the <code class="docutils literal notranslate"><span class="pre">gamepad.py</span></code> script to add functionality for relinquishing and regaining control of the robot. This will allow users to toggle control states using specific gamepad buttons.</p>
<ol class="arabic">
<li><p>Locate and open the <code class="docutils literal notranslate"><span class="pre">gamepad.py</span></code> file.</p></li>
<li><p>In the constructor of the <code class="docutils literal notranslate"><span class="pre">Gamepad</span></code> class, add the following attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flag to track control status (default: True)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">has_control</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Create a publisher for control relinquishment messages.</span>
<span class="c1"># - Publishes to the &#39;ctrl_relinq&#39; topic.</span>
<span class="c1"># - Uses Bool messages to indicate control status.</span>
<span class="c1"># - Queue size of 1 ensures only the latest control state is kept.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">Bool</span><span class="p">,</span> <span class="s1">&#39;ctrl_relinq&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">joy_callback</span></code> method, implement the following logic to toggle control using buttons A (Green) and B (Red):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new Bool message for &quot;control relinquishment status&quot;</span>
<span class="n">relinquish</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">()</span>

<span class="c1"># TODO: Check if the RC (Remote Control) has control and button A (Green) is pressed</span>
    <span class="c1"># Set control flag to False (relinquish control)</span>
    <span class="c1"># Change &quot;control status&quot; to relinquished.</span>
    <span class="c1"># Publish the control status</span>
    
    <span class="c1"># Log status update</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RC has relinquished control.&quot;</span><span class="p">)</span>  

<span class="c1"># TODO: Check if RC does not have control and button B (Red) is pressed</span>
    <span class="c1"># Set control flag to True (regain control)</span>
    <span class="c1"># Set control status to regained.</span>
    <span class="c1"># Publish the control status</span>
    
    <span class="c1"># Log status update</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;RC has taken over control.&quot;</span><span class="p">)</span>  

<span class="c1"># If control is relinquished, stop further processing</span>
<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_control</span><span class="p">:</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><p>From the gamepad node‚Äôs standpoint, this addition introduces a simple control‚Äëownership mechanism. The node now keeps track of whether the remote operator currently ‚Äúhas control‚Äù of the robot. When the user presses the A (Green) button, the node publishes a message indicating that control has been relinquished. When the B (Red) button is pressed, it publishes a message indicating that control has been regained.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">has_control</span></code> flag ensures that once control is relinquished, the node stops processing joystick commands entirely, preventing unintended motion. This makes the gamepad node responsible not only for reading joystick input but also for broadcasting the robot‚Äôs control state to the rest of the system.</p>
<p>This is a common safety practice in robotics to halt autonomous tasks a robot is executing.  Another safety practice is to integrating an easily accessible emergency stop switch that cuts off the main power to the robot.</p>
</li>
<li><p>Test the gamepad node:</p>
<ul class="simple">
<li><p>Run the gamepad node.</p></li>
<li><p>Open another terminal and monitor the <code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code> topic.</p></li>
<li><p>Press <strong>button A</strong> on the gamepad and verify that control is relinquished (no movement commands should be published by the gamepad).</p></li>
<li><p>Press <strong>button B</strong> and verify that control is regained (movement commands should be published again).</p></li>
<li><p>Check the <code class="docutils literal notranslate"><span class="pre">ctrl_relinq</span></code> topic to confirm that control status messages are being published.</p></li>
</ul>
</li>
</ol>
</section>
<section id="create-a-new-ros2-package">
<h3><strong>Create a New ROS2 Package</strong><a class="headerlink" href="#create-a-new-ros2-package" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Open a terminal and navigate to the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory of your workspace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/master_ws/src/ece387_ws
</pre></div>
</div>
</li>
<li><p>Use the following command to create a new ROS2 package named <code class="docutils literal notranslate"><span class="pre">lab6_nav</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>lab6_nav<span class="w"> </span>--build-type<span class="w"> </span>ament_python<span class="w"> </span>--dependencies<span class="w"> </span>rclpy<span class="w"> </span>geometry_msgs<span class="w"> </span>nav_msgs<span class="w"> </span>sensor_msgs
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Dependencies:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rclpy</span></code>: ROS2 Python API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geometry_msgs</span></code>: For <code class="docutils literal notranslate"><span class="pre">Twist</span></code> messages (velocity commands).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nav_msgs</span></code>: For <code class="docutils literal notranslate"><span class="pre">Odometry</span></code> messages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sensor_msgs</span></code>: For <code class="docutils literal notranslate"><span class="pre">IMU</span></code> messages.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Download the <a class="reference download internal" download="" href="../_downloads/f1b3794f9ac6b2b5c578e1db16e65d18/move2goal.py"><span class="xref download myst"><code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code></span></a> file and save it in the <code class="docutils literal notranslate"><span class="pre">lab6_nav</span></code> package directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">master_ws</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">ece387_ws</span><span class="o">/</span><span class="n">lab6_nav</span><span class="o">/</span><span class="n">lab6_nav</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file and modify the <code class="docutils literal notranslate"><span class="pre">entry_points</span></code> section to include the <code class="docutils literal notranslate"><span class="pre">move2goal</span></code> script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;move2goal = lab6_nav.move2goal:main&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">},</span>
</pre></div>
</div>
</li>
<li><p>Build the package using the <code class="docutils literal notranslate"><span class="pre">ccbuild</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ccbuild
</pre></div>
</div>
</li>
</ol>
</section>
<section id="implement-the-move2goal-py-script">
<h3><strong>Implement the <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code> Script</strong><a class="headerlink" href="#implement-the-move2goal-py-script" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code> script will control the TurtleBot3 to move to a specified goal location and orientation. Follow these steps to complete the implementation:</p>
<ol class="arabic">
<li><p>Initialize publishers and subscribers.</p>
<ul class="simple">
<li><p><strong>Publisher:</strong> Create a publisher for <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code> to send velocity commands to the robot.</p></li>
<li><p><strong>Subscribers:</strong> Subscribe to:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/odom</span></code> to track the robot‚Äôs position.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/imu</span></code> to get orientation data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/ctrl_relinq</span></code> to check if the node has control.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">odom_callback</span></code> function</p>
<ul class="simple">
<li><p>Extract the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> position from the received <code class="docutils literal notranslate"><span class="pre">Odometry</span></code> message.</p></li>
</ul>
</li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">imu_callback</span></code> function</p>
<ul class="simple">
<li><p>Extract the quaternion orientation from the <code class="docutils literal notranslate"><span class="pre">Imu</span></code> message.</p></li>
<li><p>Convert the quaternion to Euler angles using the <code class="docutils literal notranslate"><span class="pre">euler_from_quaternion</span></code> function.</p></li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">yaw</span></code> value.</p></li>
</ul>
</li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">ctrl_relinq_callback</span></code> function</p>
<ul class="simple">
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">self.has_control</span></code> flag based on the received <code class="docutils literal notranslate"><span class="pre">Bool</span></code> message.</p></li>
<li><p>Log a message indicating whether control is taken or relinquished.</p></li>
</ul>
<p>From the robot‚Äôs standpoint, <code class="docutils literal notranslate"><span class="pre">self.has_control</span></code> acts as a permission gate. When this flag becomes False, the robot immediately stops generating motion commands, ensuring that autonomous behavior halts the moment control is taken away. When the flag is True, the robot is allowed to continue computing and publishing <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code> commands toward the goal. In other words, the flag tells the robot whether it is allowed to act.</p>
<p>The gamepad node is the source of control decisions‚Äîit sets the control state based on button presses and publishes that state on the <code class="docutils literal notranslate"><span class="pre">ctrl_relinq</span></code> topic. The robot (via <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code>) is the consumer of that decision‚Äîit listens, updates its own <code class="docutils literal notranslate"><span class="pre">self.has_control</span></code>, and behaves accordingly. This separation keeps the control logic clean: the gamepad decides, and the robot obeys.</p>
</li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">control_loop</span></code> function</p>
<ul class="simple">
<li><p>Compute the <strong>angle to the goal</strong> and normalize it to the range [-<span class="math notranslate nohighlight">\(\pi\)</span>, <span class="math notranslate nohighlight">\(\pi\)</span>].</p></li>
<li><p>Compute the <strong>distance to the goal</strong> using the Euclidean distance formula.</p></li>
</ul>
</li>
<li><p>Complete the state machine logic: The state machine consists of four states:</p>
<ul class="simple">
<li><p><strong>ROTATE_TO_GOAL:</strong></p>
<ul>
<li><p>If the angle error is greater than <code class="docutils literal notranslate"><span class="pre">0.05</span></code> radians, rotate the robot with an angular speed proportional to the error (<code class="docutils literal notranslate"><span class="pre">0.3</span> <span class="pre">*</span> <span class="pre">angle_error</span></code>). Adjust the proportional coefficient as needed.</p></li>
<li><p>If the angle error is within the threshold, transition to <code class="docutils literal notranslate"><span class="pre">MOVE_FORWARD</span></code>.</p></li>
</ul>
</li>
<li><p><strong>MOVE_FORWARD:</strong></p>
<ul>
<li><p>Move the robot forward at a constant speed of <code class="docutils literal notranslate"><span class="pre">0.15</span></code> (adjustable, but the robot‚Äôs maximum speed is <code class="docutils literal notranslate"><span class="pre">0.22</span></code>).</p></li>
<li><p>If the distance to the goal is less than <code class="docutils literal notranslate"><span class="pre">0.15</span></code>, transition to <code class="docutils literal notranslate"><span class="pre">ROTATE_TO_FINAL</span></code>.</p></li>
</ul>
</li>
<li><p><strong>ROTATE_TO_FINAL:</strong></p>
<ul>
<li><p>Compute the final orientation error and normalize it.</p></li>
<li><p>If the error is greater than <code class="docutils literal notranslate"><span class="pre">0.05</span></code> radians, rotate the robot with a speed proportional to the error (<code class="docutils literal notranslate"><span class="pre">0.5</span> <span class="pre">*</span> <span class="pre">final_angle_error</span></code>).</p></li>
<li><p>If the error is within the threshold, transition to <code class="docutils literal notranslate"><span class="pre">GOAL_REACHED</span></code>.</p></li>
</ul>
</li>
<li><p><strong>GOAL_REACHED:</strong></p>
<ul>
<li><p>Log a message confirming the goal has been reached.</p></li>
<li><p>Stop publishing movement commands.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Publish velocity commands: Ensure <code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code> messages are published correctly in each state of the state machine.</p></li>
</ol>
</section>
<section id="build-and-test-the-package">
<h3><strong>Build and Test the Package</strong><a class="headerlink" href="#build-and-test-the-package" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Build the <code class="docutils literal notranslate"><span class="pre">lab6_nav</span></code> package using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ccbuild<span class="w"> </span>--packages-select<span class="w"> </span>lab6_nav
</pre></div>
</div>
</li>
<li><p>Demo the robot:</p>
<ul class="simple">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">move2goal</span></code> node and demonstrate the robot moving to the goal location <code class="docutils literal notranslate"><span class="pre">(-0.61,</span> <span class="pre">0.61)</span></code> in meters.</p></li>
<li><p>Rotate the robot to face <code class="docutils literal notranslate"><span class="pre">0¬∞</span></code>.</p></li>
<li><p><strong>Hint:</strong> Most floor and ceiling tiles in the U.S. are 1‚Äô by 1‚Äô or 2‚Äô by 2‚Äô. Use this to estimate distances. (1 foot = 30.48 cm).</p></li>
</ul>
</li>
</ol>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/OXq5pgE4C6M?si=R9m2p0erJwloZ9VT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</center>
</section>
<section id="deliverables">
<h3>üöö Deliverables<a class="headerlink" href="#deliverables" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>[15 Points] Complete the <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code> Script:</strong></p>
<ul class="simple">
<li><p>Ensure the script is fully functional and implements all required features.</p></li>
<li><p>Push your code to GitHub and confirm that it has been successfully uploaded. <strong>NOTE:</strong> <em>If the instructor can‚Äôt find your code in your repository, you will receive a grade of 0 for the coding part.</em></p></li>
</ul>
</li>
<li><p><strong>[15 Points] Demonstration:</strong></p>
<ul class="simple">
<li><p>Show the robot successfully navigating to the goal location and orientation in a real-world setup.</p></li>
</ul>
</li>
<li><p><strong>[20 Points] Performance Analysis:</strong></p>
<ul class="simple">
<li><p>Examine the distance and angle errors printed by <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code>.</p></li>
<li><p>Discuss the robot‚Äôs performance:</p>
<ul>
<li><p>Can the robot navigate to a farther distance, such as <code class="docutils literal notranslate"><span class="pre">(-3,</span> <span class="pre">3)</span></code>? Why or why not?</p></li>
<li><p>After the robot reaches the goal, restart the demo without rebooting the robot. Does it work as before? If not, why doesn‚Äôt it work anymore?</p></li>
<li><p>Suggest improvements to enhance the robot‚Äôs navigation capabilities.</p></li>
</ul>
</li>
<li><p>Note 1: This deliverable is worth 20 points, more than the other deliverables. Therefore, a detailed and rigorous analysis is expected. Treat this as the analysis section of your project report.</p></li>
<li><p>Note 2: Provide quantitative analysis, not qualitative. You don‚Äôt need to include plots of measured data, but you should provide the measured data for your analysis. For example, instead of saying, ‚ÄúThe robot‚Äôs orientation drifted quite a bit as it traveled almost one meter,‚Äù you should say, ‚ÄúWith its initial orientation of 43.5<span class="math notranslate nohighlight">\(^\circ\)</span>, the robot gradually drifted to 39.3<span class="math notranslate nohighlight">\(^\circ\)</span> after traveling 0.73 meters.‚Äù For your project, you will need to provide plots for the measured data.</p></li>
</ul>
</li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lab5_TurtleBot.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">üî¨ Lab5: Driving the Robot</p>
      </div>
    </a>
    <a class="right-next"
       href="Lab7_TF.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">üî¨ Lab7: Transformation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">üìú Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-lab-testing-the-imu">üå± Pre-Lab: Testing the IMU</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-launch-the-turtlebot3-simulation">Step 1: Launch the TurtleBot3 Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-verify-communication-with-the-master">Step 2: Verify Communication with the Master</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-examine-the-imu-and-odom-topics">Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-visualizing-data-in-rqt">Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-procedure">üíª Lab Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bashrc-for-easier-builds">üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> for Easier Builds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-imu-on-the-physical-robot">üõ† Testing IMU on the Physical Robot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modify-gamepad-py-to-include-control-relinquishment">üõ† Modify <code class="docutils literal notranslate"><span class="pre">gamepad.py</span></code> to Include Control Relinquishment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-ros2-package"><strong>Create a New ROS2 Package</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-move2goal-py-script"><strong>Implement the <code class="docutils literal notranslate"><span class="pre">move2goal.py</span></code> Script</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-test-the-package"><strong>Build and Test the Package</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deliverables">üöö Deliverables</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stan Baek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>