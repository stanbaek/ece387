
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>üî¨ Lab6: IMU &#8212; Introduction to Robotic Systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Labs/Lab6_IMU';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="üî¨ Lab7: Launch Files" href="Lab7_LaunchFile.html" />
    <link rel="prev" title="üî¨ Lab5: Driving the Robot" href="Lab5_TurtleBot.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/ece387.png" class="logo__image only-light" alt="Introduction to Robotic Systems - Home"/>
    <img src="../_static/ece387.png" class="logo__image only-dark pst-js-only" alt="Introduction to Robotic Systems - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    ECE 387 Introduction to Robotic Systems
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">üìå Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">üìÜ Course Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonBasic.html">üêç Python Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonIntermediate.html">üêç Python Intermediate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NumPy.html">‚ûï NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">üôã FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stanbaek.github.io/NoPointer.html">No Pointers in Python?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Labs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Lab1_Linux.html">üî¨ Lab1: Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab2_ROS.html">üî¨ Lab2: ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab3_Python.html">üî¨ Lab3: Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab4_Gamepad.html">üî¨ Lab4: Gamepad</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab5_TurtleBot.html">üî¨ Lab5: Driving the Robot</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">üî¨ Lab6: IMU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab7_LaunchFile.html">üî¨ Lab7: Launch Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab8_LIDAR.html">üî¨ Lab8: LIDAR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Appendix/RobotSetup.html">üîß Robot Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/MasterSetup.html">üîß Master Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/GitSetup.html">üîß Git Repo Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/GamepadSetup.html">üîß Gamepad Setup</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/stanbaek/ece387" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/stanbaek/ece387/issues/new?title=Issue%20on%20page%20%2FLabs/Lab6_IMU.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Labs/Lab6_IMU.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>üî¨ Lab6: IMU</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">üìú Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imu-calibration">IMU Calibration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-lab-testing-the-imu">üå± Pre-Lab: Testing the IMU</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-launch-the-turtlebot3-simulation">Step 1: Launch the TurtleBot3 Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-verify-communication-with-the-master">Step 2: Verify Communication with the Master</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-examine-the-imu-and-odom-topics">Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-visualizing-data-in-rqt">Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-procedure">üíª Lab Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bashrc">üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-imu-on-the-physical-robot">üõ† Testing IMU on the Physical Robot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Step 2: Verify Communication with the Master</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">üíª Lab Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checkpoint">Checkpoint</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cleanup">Cleanup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">Purpose</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#master">Master</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controller-py">controller.py</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-your-nodes">Run your nodes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#report">Report</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turn-in-requirements">Turn-in Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-create-a-new-ros2-package"><strong>üõ† Step 1: Create a New ROS2 Package</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-write-the-python-node"><strong>üìù Step 2: Write the Python Node</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-update-setup-py"><strong>üì¶ Step 3: Update <code class="docutils literal notranslate"><span class="pre">setup.py</span></code></strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-build-and-source-the-package"><strong>üîß Step 4: Build and Source the Package</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-run-the-node"><strong>üöÄ Step 5: Run the Node</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab6-imu">
<h1>üî¨ Lab6: IMU<a class="headerlink" href="#lab6-imu" title="Link to this heading">#</a></h1>
<section id="objectives">
<h2>üìå Objectives<a class="headerlink" href="#objectives" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Students should be able to u</p></li>
</ul>
</section>
<section id="overview">
<h2>üìú Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>In real-world applications, an Inertial Measurement Unit (IMU) provides essential motion data, including orientation, angular velocity, and linear acceleration. The <a class="reference external" href="https://invensense.tdk.com/products/motion-tracking/6-axis/icm-20648/">ICM-20648 6-Axis MEMS MotionTracking Device</a> from TDK integrates a 3-axis gyroscope, a 3-axis accelerometer, and a Digital Motion Processor (DMP). This IMU is embedded in the OpenCR1.0 board, an open-source robot controller featuring an ARM Cortex-M7 processor. The OpenCR board uses an Extended Kalman Filter (EKF) to fuse sensor data, generating IMU estimates at a rate of 170 updates per second.</p>
<a class="reference internal image-reference" href="../_images/IMU.jpg"><img alt="../_images/IMU.jpg" class="align-center" src="../_images/IMU.jpg" style="width: 380px;" /></a>
<br>
<p>The IMU plays a crucial role in determining the robot‚Äôs state and enhancing navigation accuracy. When combined with tachometer data, it helps estimate the robot‚Äôs position over time (odometry).</p>
<a class="reference internal image-reference" href="../_images/TurtleBot3_Coordinates.png"><img alt="../_images/TurtleBot3_Coordinates.png" class="align-center" src="../_images/TurtleBot3_Coordinates.png" style="width: 280px;" /></a>
<section id="imu-calibration">
<h3>IMU Calibration<a class="headerlink" href="#imu-calibration" title="Link to this heading">#</a></h3>
<p>As mentioned earlier, multiple sensors work together to estimate the TurtleBot3‚Äôs attitude and heading. These sensors are highly sensitive to magnetic fields, which vary by location and device. Even common electronic components generate small magnetic fields, including those from the OpenCR board itself. While the IMU is strategically placed at the center of the robot for optimal performance, it is still exposed to various magnetic interferences.</p>
<p>Fortunately, the TurtleBot3 developers accounted for this challenge. Each time you run the serial node to connect to the robot, the IMU automatically calibrates itself, ensuring more reliable readings.</p>
</section>
</section>
<section id="pre-lab-testing-the-imu">
<h2>üå± Pre-Lab: Testing the IMU<a class="headerlink" href="#pre-lab-testing-the-imu" title="Link to this heading">#</a></h2>
<section id="step-1-launch-the-turtlebot3-simulation">
<h3>Step 1: Launch the TurtleBot3 Simulation<a class="headerlink" href="#step-1-launch-the-turtlebot3-simulation" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Open a terminal and start the TurtleBot3 simulation in Gazebo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>launch<span class="w"> </span>turtlebot3_gazebo<span class="w"> </span>turtlebot_world.launch
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-2-verify-communication-with-the-master">
<h3>Step 2: Verify Communication with the Master<a class="headerlink" href="#step-2-verify-communication-with-the-master" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Ensure the TurtleBot3 is properly communicating with the Master by listing active topics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span>list
</pre></div>
</div>
</li>
<li><p>You should see the following topics, including <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/battery_state
/cmd_vel
/imu
/joint_states
/magnetic_field
/odom<span class="w">   </span>
/tf_static
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-3-examine-the-imu-and-odom-topics">
<h3>Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics<a class="headerlink" href="#step-3-examine-the-imu-and-odom-topics" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">gamepad</span></code> and <code class="docutils literal notranslate"><span class="pre">joy</span></code> nodes.</p></li>
<li><p>As you move the robot in Gazebo, observe the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom
</pre></div>
</div>
</li>
<li><p>Pay close attention to the <code class="docutils literal notranslate"><span class="pre">pose</span></code> field. In future labs, be careful not to confuse the different pose hierarchies within the <code class="docutils literal notranslate"><span class="pre">Imu</span></code> and <code class="docutils literal notranslate"><span class="pre">Odom</span></code> messages.</p></li>
</ol>
</section>
<section id="step-4-visualizing-data-in-rqt">
<h3>Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code><a class="headerlink" href="#step-4-visualizing-data-in-rqt" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">rqt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>rqt
</pre></div>
</div>
</li>
<li><p>Move the robot in Gazebo and observe the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics in <code class="docutils literal notranslate"><span class="pre">rqt</span></code>.</p></li>
<li><p>In Gazebo, navigate to <code class="docutils literal notranslate"><span class="pre">Models</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">burger</span></code>, then in the <code class="docutils literal notranslate"><span class="pre">property</span></code> section, select <code class="docutils literal notranslate"><span class="pre">pose</span></code> to display the robot‚Äôs position and orientation (expressed in roll-pitch-yaw format).</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">rqt</span></code>, activate the <code class="docutils literal notranslate"><span class="pre">Topic</span> <span class="pre">Monitor</span></code> and enable <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> to track orientation and position in real time.</p></li>
<li><p>Note that orientation in <code class="docutils literal notranslate"><span class="pre">rqt</span></code> is shown using quaternions.</p></li>
<li><p>The pose values in Gazebo and rqt are not the same. Gazebo simulation publishes position and orientation with noise. By default, Gazebo adds Gaussian noise to the data generated by its sensors to simulate real-world conditions.</p></li>
</ol>
</section>
</section>
<section id="lab-procedure">
<h2>üíª Lab Procedure<a class="headerlink" href="#lab-procedure" title="Link to this heading">#</a></h2>
<section id="update-bashrc">
<h3>üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code><a class="headerlink" href="#update-bashrc" title="Link to this heading">#</a></h3>
<p>Many cadets frequently make mistakes when running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code>. It is crucial to run it inside the <code class="docutils literal notranslate"><span class="pre">~/master_ws</span></code> directory and then source <code class="docutils literal notranslate"><span class="pre">install/setup.bash</span></code>. To prevent errors, follow these instructions carefully:</p>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> using <code class="docutils literal notranslate"><span class="pre">gedit</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gedit<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</li>
<li><p>Add the following function at the end of the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to build with optional arguments</span>
<span class="k">function</span><span class="w"> </span>ccbuild<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="nb">cd</span><span class="w"> </span>~/master_ws<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>colcon<span class="w"> </span>build<span class="w"> </span>--symlink-install<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="nb">source</span><span class="w"> </span>~/master_ws/install/setup.bash
<span class="o">}</span>

<span class="c1"># Export the function to make it available in the shell</span>
<span class="nb">export</span><span class="w"> </span>-f<span class="w"> </span>ccbuild
</pre></div>
</div>
</li>
<li><p>Save the file, exit the editor, and restart your terminal.</p></li>
<li><p>Instead of manually navigating to <code class="docutils literal notranslate"><span class="pre">~/master_ws</span></code>, running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span> <span class="pre">--symlink-install</span></code>, and sourcing <code class="docutils literal notranslate"><span class="pre">install/setup.bash</span></code>, you can now simply run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ccbuild
</pre></div>
</div>
<p>This ensures <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> runs in the correct directory and sources the necessary setup file.</p>
</li>
<li><p>You can also pass additional arguments to <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code>. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ccbuild<span class="w"> </span>--packages-select<span class="w"> </span>lab6_nav
</pre></div>
</div>
<p>This builds only the <code class="docutils literal notranslate"><span class="pre">lab6_nav</span></code> package, saving time by skipping previously built packages.</p>
</li>
</ol>
<p>By following these steps, you‚Äôll streamline your workflow and minimize build-related errors.</p>
</section>
<section id="testing-imu-on-the-physical-robot">
<h3>üõ† Testing IMU on the Physical Robot<a class="headerlink" href="#testing-imu-on-the-physical-robot" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Use SSH to launch <code class="docutils literal notranslate"><span class="pre">robot.launch.py</span></code> on the robot.</p></li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">gamepad</span></code> and <code class="docutils literal notranslate"><span class="pre">joy</span></code> nodes on the master computer.</p></li>
<li><p>As you move the robot in Gazebo, observe the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom
</pre></div>
</div>
</li>
<li><p>Both topics have too many lines of outputs to easily examine them. Run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="s1">&#39;orientation&#39;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="s1">&#39;position&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="s1">&#39;orientation&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-A</span> <span class="pre">3</span></code> option in the <code class="docutils literal notranslate"><span class="pre">grep</span></code> command stands for ‚Äúafter context.‚Äù It tells <code class="docutils literal notranslate"><span class="pre">grep</span></code> to display the specified number of lines following the matching line.
This command will:</p>
<ul class="simple">
<li><p>Echo messages from the /odom topic.</p></li>
<li><p>Pipe the output to grep to search for the string ‚Äòposition‚Äô.</p></li>
<li><p>Display the matching line and the next 3 lines following each match.</p></li>
</ul>
<p>This can be useful when you want to see additional context around the matched lines. In this case, you will see the ‚Äòposition‚Äô section and the next three lines that follow it in the /odom topic messages.</p>
</li>
<li><p>Open a terminal and start the TurtleBot3 simulation in Gazebo:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>launch<span class="w"> </span>turtlebot3_gazebo<span class="w"> </span>turtlebot_world.launch
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id1">
<h3>Step 2: Verify Communication with the Master<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Ensure the TurtleBot3 is properly communicating with the Master by listing active topics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span>list
</pre></div>
</div>
</li>
<li><p>You should see the following topics, including <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/battery_state
/cmd_vel
/imu
/joint_states
/magnetic_field
/odom<span class="w">   </span>
/tf_static
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id2">
<h3>Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">gamepad</span></code> and <code class="docutils literal notranslate"><span class="pre">joy</span></code> nodes.</p></li>
<li><p>As you move the robot in Gazebo, observe the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/imu
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>/odom
</pre></div>
</div>
</li>
<li><p>Pay close attention to the <code class="docutils literal notranslate"><span class="pre">pose</span></code> field. In future labs, be careful not to confuse the different pose hierarchies within the <code class="docutils literal notranslate"><span class="pre">Imu</span></code> and <code class="docutils literal notranslate"><span class="pre">Odom</span></code> messages.</p></li>
</ol>
</section>
<section id="id3">
<h3>Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code><a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">rqt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>rqt
</pre></div>
</div>
</li>
<li><p>Move the robot in Gazebo and observe the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics in <code class="docutils literal notranslate"><span class="pre">rqt</span></code>.</p></li>
<li><p>In Gazebo, navigate to <code class="docutils literal notranslate"><span class="pre">Models</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">burger</span></code>, then in the <code class="docutils literal notranslate"><span class="pre">property</span></code> section, select <code class="docutils literal notranslate"><span class="pre">pose</span></code> to display the robot‚Äôs position and orientation (expressed in roll-pitch-yaw format).</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">rqt</span></code>, activate the <code class="docutils literal notranslate"><span class="pre">Topic</span> <span class="pre">Monitor</span></code> and enable <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> to track orientation and position in real time.</p></li>
<li><p>Note that orientation in <code class="docutils literal notranslate"><span class="pre">rqt</span></code> is shown using quaternions.</p></li>
<li><p>The pose values in Gazebo and rqt are not the same. Gazebo simulation publishes position and orientation with noise. By default, Gazebo adds Gaussian noise to the data generated by its sensors to simulate real-world conditions.</p></li>
</ol>
</section>
</section>
<section id="id4">
<h2>üíª Lab Procedure<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<section id="id5">
<h3>üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code><a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>Many cadets frequently make mistakes when running <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code>. It is crucial to run it inside the <code class="docutils literal notranslate"><span class="pre">~/master_ws</span></code> directory and then source <code class="docutils literal notranslate"><span class="pre">install/setup.bash</span></code>. To prevent errors, follow these instructions carefully:</p>
<ol class="arabic">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> using <code class="docutils literal notranslate"><span class="pre">gedit</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gedit<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</li>
<li><p><strong>Establish a Secure Shell (SSH) Connection</strong> to your TurtleBot3 and launch the core launch file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>turtlebot3_bringup<span class="w"> </span>turtlebot3_core.launch
</pre></div>
</div>
</li>
<li><p><strong>Check Active Topics</strong> from your Master terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>topic<span class="w"> </span>list
</pre></div>
</div>
<p>Look for <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> in the list.</p>
</li>
<li><p><strong>Observe the IMU Data</strong>:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">echo</span></code> to display live data from the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topics.</p></li>
<li><p>Rotate the robot and watch the values change.</p></li>
</ul>
</li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">/imu</span></code> topic fuses data from the gyroscope and accelerometer to provide orientation, angular velocity, and linear acceleration. The <code class="docutils literal notranslate"><span class="pre">/odom</span></code> topic further incorporates tachometer data to estimate position, orientation, and velocity.</p>
<p>Since both topics report orientation using quaternions, we will convert them to Euler angles for better readability. For this, we will use the Python library <a class="reference external" href="https://pypi.org/project/squaternion/">squaternion</a>.</p>
<hr class="docutils" />
<p>By completing this pre-lab, you will gain hands-on experience interpreting IMU data and understanding how it integrates with the robot‚Äôs navigation system. In the next lab, we will use these values to execute precise robot movements.</p>
<p>Create a secure shell connection to your <strong>Robot</strong> and launch the Turtlebot3 core launchfile.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch<span class="w"> </span>turtlebot3_bringup<span class="w"> </span>turtlebot3_core.launch
</pre></div>
</div>
<p>Open a new terminal on your <strong>Master</strong> and observe what topics are running.</p>
<p>You should note two topics of interest: <strong>/imu</strong> and <strong>/odom</strong>.</p>
<p>Echo the output of each of the topics and rotate the <strong>Robot</strong> to see the values change.</p>
<p>The <strong>/imu</strong> topic combines information from the gyroscope and accelerometer to provide orientation, angular velocity, and linear acceleration. The <strong>/odom</strong> topic combines the information from the <strong>/imu</strong> topic and tachometers to estimate position, orientation, and linear and angular velocities.</p>
<p>Both of these topics provide the orientation of the robot using a quaternion representation. While quaternions can make computation easier, they are not very human readable, so we will convert to Euler angles. To do this we will use a Python library called <a class="reference external" href="https://pypi.org/project/squaternion/">squaternion</a>.</p>
<ol class="arabic">
<li><p><strong>Using SSH, launch the <code class="docutils literal notranslate"><span class="pre">robot.launch.py</span></code> file on the robot</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ros2<span class="w"> </span>launch<span class="w"> </span>turt1ebot3_bringup<span class="w"> </span>robot.launch
</pre></div>
</div>
<p>Ensure you see <strong>‚ÄúRun!‚Äù</strong> at the end of the output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>turtlebot3_ros-3<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1738299487</span>.851512798<span class="o">]</span><span class="w"> </span><span class="o">[</span>turtlebot3_node<span class="o">]</span>:<span class="w"> </span>Succeeded<span class="w"> </span>to<span class="w"> </span>create<span class="w"> </span>sound<span class="w"> </span>server
<span class="o">[</span>turtlebot3_ros-3<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1738299487</span>.853739761<span class="o">]</span><span class="w"> </span><span class="o">[</span>turtlebot3_node<span class="o">]</span>:<span class="w"> </span>Run!
<span class="o">[</span>turtlebot3_ros-3<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1738299487</span>.890749557<span class="o">]</span><span class="w"> </span><span class="o">[</span>diff_drive_controller<span class="o">]</span>:<span class="w"> </span>Init<span class="w"> </span>Odometry
<span class="o">[</span>turtlebot3_ros-3<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="m">1738299487</span>.909780816<span class="o">]</span><span class="w"> </span><span class="o">[</span>diff_drive_controller<span class="o">]</span>:<span class="w"> </span>Run!
</pre></div>
</div>
</li>
</ol>
<p>The two main functions we will use from the squaternion library:</p>
<p>First we will need to create a Quaternion object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we will conver that Quaternion to an Euler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">to_euler</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have <code class="docutils literal notranslate"><span class="pre">e</span></code>, an array representing our Euler angles, <code class="docutils literal notranslate"><span class="pre">e[roll,</span> <span class="pre">pitch,</span> <span class="pre">yaw]</span></code>.</p>
<p>You can keep the node running for the next portion of the lesson.</p>
<ol class="arabic simple">
<li><p>Copy and complete the below code using a GUI editor tool, such as <strong>Sublime</strong> or <strong>VS Code</strong>. Browse to the subscriber you just created and double-click. This will open the file in <strong>Sublime</strong> or <strong>VS Code</strong> (if it is open in any other editor, stop, raise your hand, and get help from an instructor)</p></li>
</ol>
<blockquote>
<div><p>üí°Ô∏è <strong>Tip:</strong> Look for the <strong>‚ÄúTODO‚Äù</strong> tag which indicates where you should insert your own code.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Save, exit, and make the node executable.</p></li>
<li><p>Open a new terminal on the <strong>Master</strong> and run the <strong>imu_sub.py</strong> node.</p></li>
<li><p>Rotate the <strong>Robot</strong> and observe the output.</p></li>
</ol>
</section>
</section>
<section id="checkpoint">
<h2>Checkpoint<a class="headerlink" href="#checkpoint" title="Link to this heading">#</a></h2>
<p>Once complete, get checked off by an instructor showing the output of your <strong>imu_sub</strong> and <strong>rqt_graph</strong> node.  Push your ice6 package to your repo for credit</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this lesson you learned how to utilize the on-board IMU and determine the orientation of the Turtlebot3. In the lab that corresponds to this lesson you will apply this knowledge to turn the robot in 90 and 180 degree turns.ROS</p>
</section>
<section id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Link to this heading">#</a></h2>
<p>In each terminal window, close the node by typing <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code>. Exit any SSH connections. Shutdown the notebook server by typing <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> within the terminal you ran <code class="docutils literal notranslate"><span class="pre">jupyter-lab</span></code> in. Select ‚Äòy‚Äô.</p>
<p><strong>Ensure roscore is terminated before moving on to the lab.</strong></p>
</section>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">#</a></h2>
<p>This lab will integrate the on-board IMU with the Turtlebot3 controller to turn the robot 90 degrees left or right.  Do not disable any of the mouse controller functionality in the turtlebot_controller.py code.  The IMU and mouse control functionality should be able to coexist seemlessly.</p>
</section>
<section id="master">
<h2>Master<a class="headerlink" href="#master" title="Link to this heading">#</a></h2>
<section id="setup">
<h3>Setup:<a class="headerlink" href="#setup" title="Link to this heading">#</a></h3>
<p>In the <code class="docutils literal notranslate"><span class="pre">/master_ws/src/ece387_master_sp2X-USERNAME/master</span></code> folder, create a <strong>lab2</strong> package which depends on <strong>std_msgs</strong>, <strong>rospy</strong>, <strong>geometry_msgs</strong>, and <strong>turtlebot3_bringup</strong>.</p>
</section>
<section id="controller-py">
<h3><a class="reference external" href="http://controller.py">controller.py</a><a class="headerlink" href="#controller-py" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Copy the turtlebot_controller.py file from lab1 into the lab2 package.</p></li>
<li><p>Open the turtlebot_controller.py file from lab2 using an editor.</p></li>
<li><p>Import the squaternion library and Imu message used in ICE6.</p></li>
</ol>
</section>
</section>
<section id="run-your-nodes">
<h2>Run your nodes<a class="headerlink" href="#run-your-nodes" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>On the <strong>Master</strong> open a terminal and run <strong>roscore</strong>.</p></li>
<li><p>Open another terminal and enable statistics for <strong>rqt_graph</strong>.</p></li>
<li><p>Run the controller node.</p></li>
<li><p>Open secure shell into the <strong>Robot</strong> and run the <strong>turtlebot3_core</strong> launch file.</p></li>
<li><p>Type ‚Äúl‚Äù or ‚Äúr‚Äù to turn the robot 90 degrees.</p></li>
</ol>
</section>
<section id="report">
<h2>Report<a class="headerlink" href="#report" title="Link to this heading">#</a></h2>
<p>Complete a short 2-3 page report that utilizes the format and answers the questions within the report template. The report template and an example report can be found within the Team under <code class="docutils literal notranslate"><span class="pre">Resources/Lab</span> <span class="pre">Template</span></code>.</p>
</section>
<section id="turn-in-requirements">
<h2>Turn-in Requirements<a class="headerlink" href="#turn-in-requirements" title="Link to this heading">#</a></h2>
<p><strong>[25 points]</strong> Demonstration of keyboard control of Turtlebot3 (preferably in person, but can be recorded and posted to Teams under the Lab 2 channel).</p>
<p><strong>[50 points]</strong> Report via Gradescope.</p>
<p><strong>[25 points]</strong> Code: push your code to your repository. Also, include a screen shot of the <strong>turtlebot_controller.py</strong> file at the end of your report.</p>
<p>Here‚Äôs a <strong>step-by-step guide</strong> to create a <strong>Python ROS2 package</strong> that moves the TurtleBot3 to a desired <strong>location and orientation</strong> using <strong>IMU (<code class="docutils literal notranslate"><span class="pre">/imu</span></code>) and ODOM (<code class="docutils literal notranslate"><span class="pre">/odom</span></code>)</strong> topics in <strong>ROS2 Humble</strong>.</p>
</section>
<hr class="docutils" />
<section id="step-1-create-a-new-ros2-package">
<h2><strong>üõ† Step 1: Create a New ROS2 Package</strong><a class="headerlink" href="#step-1-create-a-new-ros2-package" title="Link to this heading">#</a></h2>
<p>Open a terminal and create a new package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_ws/src<span class="w">  </span>
ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>turtlebot3_navigation<span class="w"> </span>--build-type<span class="w"> </span>ament_python<span class="w"> </span>--dependencies<span class="w"> </span>rclpy<span class="w"> </span>geometry_msgs<span class="w"> </span>nav_msgs<span class="w"> </span>sensor_msgs
</pre></div>
</div>
<p>This creates a package named <code class="docutils literal notranslate"><span class="pre">turtlebot3_navigation</span></code> with dependencies:<br />
‚úÖ <code class="docutils literal notranslate"><span class="pre">rclpy</span></code> ‚Üí ROS2 Python API<br />
‚úÖ <code class="docutils literal notranslate"><span class="pre">geometry_msgs</span></code> ‚Üí For <code class="docutils literal notranslate"><span class="pre">Twist</span></code> messages (velocity commands)<br />
‚úÖ <code class="docutils literal notranslate"><span class="pre">nav_msgs</span></code> ‚Üí For <code class="docutils literal notranslate"><span class="pre">Odometry</span></code> messages<br />
‚úÖ <code class="docutils literal notranslate"><span class="pre">sensor_msgs</span></code> ‚Üí For <code class="docutils literal notranslate"><span class="pre">IMU</span></code> messages</p>
</section>
<hr class="docutils" />
<section id="step-2-write-the-python-node">
<h2><strong>üìù Step 2: Write the Python Node</strong><a class="headerlink" href="#step-2-write-the-python-node" title="Link to this heading">#</a></h2>
<p>Create a Python script inside the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_ws/src/turtlebot3_navigation/turtlebot3_navigation
touch<span class="w"> </span>move_to_goal.py
chmod<span class="w"> </span>+x<span class="w"> </span>move_to_goal.py
</pre></div>
</div>
<p>Now, open <code class="docutils literal notranslate"><span class="pre">move_to_goal.py</span></code> and add the following code:</p>
</section>
<hr class="docutils" />
<section id="step-3-update-setup-py">
<h2><strong>üì¶ Step 3: Update <code class="docutils literal notranslate"><span class="pre">setup.py</span></code></strong><a class="headerlink" href="#step-3-update-setup-py" title="Link to this heading">#</a></h2>
<p>Open <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> and modify <code class="docutils literal notranslate"><span class="pre">entry_points</span></code> to include the new script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;move_to_goal = turtlebot3_navigation.move_to_goal:main&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">},</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="step-4-build-and-source-the-package">
<h2><strong>üîß Step 4: Build and Source the Package</strong><a class="headerlink" href="#step-4-build-and-source-the-package" title="Link to this heading">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/ros2_ws
colcon<span class="w"> </span>build<span class="w"> </span>--packages-select<span class="w"> </span>turtlebot3_navigation
<span class="nb">source</span><span class="w"> </span>install/setup.bash
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="step-5-run-the-node">
<h2><strong>üöÄ Step 5: Run the Node</strong><a class="headerlink" href="#step-5-run-the-node" title="Link to this heading">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>turtlebot3_navigation<span class="w"> </span>move_to_goal
</pre></div>
</div>
<p>The robot will move to <code class="docutils literal notranslate"><span class="pre">(1.0,</span> <span class="pre">1.0)</span></code> and rotate to face <code class="docutils literal notranslate"><span class="pre">90¬∞</span></code>.</p>
<p>Would you like improvements such as dynamic goal input or PID control for smoother movement? üöÄ</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lab5_TurtleBot.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">üî¨ Lab5: Driving the Robot</p>
      </div>
    </a>
    <a class="right-next"
       href="Lab7_LaunchFile.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">üî¨ Lab7: Launch Files</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectives">üìå Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">üìú Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imu-calibration">IMU Calibration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-lab-testing-the-imu">üå± Pre-Lab: Testing the IMU</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-launch-the-turtlebot3-simulation">Step 1: Launch the TurtleBot3 Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-verify-communication-with-the-master">Step 2: Verify Communication with the Master</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-examine-the-imu-and-odom-topics">Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-visualizing-data-in-rqt">Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-procedure">üíª Lab Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#update-bashrc">üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-imu-on-the-physical-robot">üõ† Testing IMU on the Physical Robot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Step 2: Verify Communication with the Master</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Step 3: Examine the <code class="docutils literal notranslate"><span class="pre">/imu</span></code> and <code class="docutils literal notranslate"><span class="pre">/odom</span></code> Topics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Step 4: Visualizing Data in <code class="docutils literal notranslate"><span class="pre">rqt</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">üíª Lab Procedure</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">üõ† Update <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checkpoint">Checkpoint</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cleanup">Cleanup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">Purpose</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#master">Master</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controller-py">controller.py</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-your-nodes">Run your nodes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#report">Report</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#turn-in-requirements">Turn-in Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-create-a-new-ros2-package"><strong>üõ† Step 1: Create a New ROS2 Package</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-write-the-python-node"><strong>üìù Step 2: Write the Python Node</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-update-setup-py"><strong>üì¶ Step 3: Update <code class="docutils literal notranslate"><span class="pre">setup.py</span></code></strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-build-and-source-the-package"><strong>üîß Step 4: Build and Source the Package</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-run-the-node"><strong>üöÄ Step 5: Run the Node</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stan Baek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>